# CS50 TSE Querier Design Specification

## Overview

The TSE Querier is a key component of the Tiny Search Engine (TSE) that reads an index file produced by the TSE Indexer, along with page files produced by the TSE Crawler, to answer search queries submitted via stdin. The Querier supports boolean search queries consisting of sequences of words, with the operators "and" and "or" (in lowercase) to combine words. It outputs a ranked list of documents in which the search terms were found, sorted by the number of times the search terms appear in each document. 

## User Interface 

The Querier operates through a command-line interface, requiring two arguments: the path to the directory containing the page files generated by the Crawler, and the file path to the index created by the Indexer.

`$ ./querier pageDirectory indexFilename`

## Inputs and Outputs

- **Input**: The Querier accepts a series of queries entered by the user via stdin. Each query can include one or more words, optionally connected by logical operators "and" and "or."
- **Output**: For each query, the Querier prints a list of documents where the query terms were found, ranked by the number of occurrences of the search terms. Each output line includes the document's rank, its ID, the score (number of occurrences), and the document's URL.
## Major Components

## Functional Decomposition into Modules

1. **Query Processor**: Parses and validates the user's input query, ensuring it conforms to the expected syntax and semantics.
2. **Index Loader**: Reads the index from a file into an in-memory data structure optimized for query evaluation.
3. **Search Evaluator**: Processes the parsed query against the loaded index to identify matching documents.
4. **Result Ranker**: Scores and sorts the documents based on the frequency of the query terms they contain.
Output Formatter: Formats and displays the ranked list of matching documents to the user.

## Pseudo Code for Logic/Algorithmic Flow

1. function main
  2. validate command-line arguments
  3. load index from file
  4. prompt user for query
  5. while user enters a query
    6. parse and validate the query
    7. if query is valid
      8. evaluate query against index
      9. rank results based on term frequency
      10. print ranked results
    7. else
      8. print error message
    11. prompt user for next query
  12. end while
13. end function

## Major Data Structures

- **Index**: A hashtable where each key is a word from the crawled webpages, and each value is a counters set representing document IDs and the frequency of the word in each document.
- **Query**: Parsed elements of the user's query (either a search term or a logical operator).

## Error Handling Strategies

- **Invalid Queries**: Immediately rejects queries with invalid syntax, prompting the user for a new query.
- **Memory Allocation Failures**: Checks all memory allocations and gracefully exits with an error message on failure
- **File I/O Errors**: Verifies file paths and handles read/write errors to prevent crashes and data loss.


## Testing and Validation

- **Syntax Validation Tests**: Verify that the Query Processor correctly handles a range of valid and invalid queries.
- **Evaluation Logic Tests**: Test the Search Evaluator with various queries to ensure accurate document matching and correct application of "and" and "or" logic.
- **Ranking Tests**: Confirm that the Result Ranker correctly scores and orders documents according to the frequency of query terms.
End-to-End Tests: Execute comprehensive tests using real index files to validate the entire process from query input to result output.
- **Memory Leak Detection**: Utilize tools like Valgrind to identify and resolve any memory leaks to ensure efficient resource management.